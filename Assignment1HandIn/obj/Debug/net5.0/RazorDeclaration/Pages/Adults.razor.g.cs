// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace Assignment1HandIn.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Assignment1HandIn;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\_Imports.razor"
using Assignment1HandIn.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\Pages\Adults.razor"
using Assignment1HandIn.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\Pages\Adults.razor"
using Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\Pages\Adults.razor"
using System.Reflection;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\Pages\Adults.razor"
using System.Text.RegularExpressions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\Pages\Adults.razor"
           [Authorize(Policy = "MustBeLoggedIn")]

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/Adults")]
    public partial class Adults : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 110 "C:\Users\mathi\RiderProjects\Aflevering\Assignment1HandIn\Assignment1HandIn\Pages\Adults.razor"
       
    private IList<Adult> allAdult;
    private IList<Adult> adultsToShow;
    private string filterOption;
    private string filterByText;
    private float[] filterByNumbers;

    protected override async Task OnInitializedAsync()
    {
        allAdult = AdultService.GetAdults();
        adultsToShow = allAdult;
        filterOption = "FirstName";
    }

    private void RemoveAdult(int adultId)
    {
        Adult adultToRemove = allAdult.First(a => a.Id == adultId);
        allAdult.Remove(adultToRemove);
        adultsToShow.Remove(adultToRemove);
        AdultService.Remove(adultToRemove);
    }

    private void UpdateFilterOption(ChangeEventArgs arg)
    {
        filterOption = (string) arg.Value;
        filterOption = Regex.Replace(filterOption, @" ", "");
    }

    private string GetPropertyValueType(Adult adult, string property)
    {
        string type = adult.GetType().GetProperty(property).GetValue(adult).GetType().ToString();
        return type;
    }

    private dynamic GetPropertyValue(Adult adult, string property)
    {
        return adult.GetType().GetProperty(property).GetValue(adult);
    }


    private void FilterByText(ChangeEventArgs eventArgs)
    {
        filterByText = String.Empty;
        try
        {
            filterByText = ((string) eventArgs.Value).ToLower();
        }
        catch (Exception e){}
        Filter();
    }

    private void Filter()
    {
    // I tilfælde af at du læser koden Troels. Denne metode blev lidt rodet at kigge på og tænkte at køre lidt SOLID indover.
    // Min umiddelbare plan ville være state/strategy pattern. Til det har jeg dog et spørgsmål, er det state pattern eller strategy pattern her?
    // Mit første gæt ville være strategy pattern, da vi vel ikke som sådan ændre programmets adfærd? Det er stadig lidt utydeligt
    // for mig hvornår man skelner mellem de to.
    // Jeg er allerede med på at de to patterns kan implementeres på samme måde og det bare er terminologi.
        float[] toFilterBy = filterByNumbers;
        if (toFilterBy?[0] > 0 && toFilterBy[1] < toFilterBy[0] && filterOption.Equals("Salary"))
        {
            adultsToShow = allAdult.Where(adult =>
                adult.JobTitle.Salary >= toFilterBy[0]
                ).ToList();
        }
        else if (toFilterBy?[1] > 0 && filterOption.Equals("Salary"))
        {
            adultsToShow = allAdult.Where(adult =>
                adult.JobTitle.Salary <= toFilterBy[1]
                && adult.JobTitle.Salary >= toFilterBy[0]
                ).ToList();
        }
        else if (toFilterBy?[0] > 0 && toFilterBy[1] < toFilterBy[0])
        {
            adultsToShow = allAdult.Where(adult =>
                Convert.ChangeType(GetPropertyValue(adult, filterOption), Type.GetType(GetPropertyValueType(adult, filterOption))) >= toFilterBy[0]
                ).
                ToList();
        }
        else if (toFilterBy?[1] > 0 && toFilterBy[0] == null)
        {
            adultsToShow = allAdult.Where(adult =>
                Convert.ChangeType(GetPropertyValue(adult, filterOption), Type.GetType(GetPropertyValueType(adult, filterOption))) <= toFilterBy[1]
                && Convert.ChangeType(GetPropertyValue(adult, filterOption), Type.GetType(GetPropertyValueType(adult, filterOption))) >= toFilterBy[0]
                ).
                ToList();
        }
        else if (toFilterBy == null)
        {
            adultsToShow = allAdult.Where(adult =>
                ((string) GetPropertyValue(adult, filterOption)).ToLower().StartsWith(filterByText)
                ).ToList();
        }
    }


    private void FilterByMin(ChangeEventArgs eventArgs)
    {
        if (filterByNumbers == null)
            filterByNumbers = new float[2];
        try
        {
            filterByNumbers[0] = float.Parse(eventArgs.Value.ToString());
        }
        catch (Exception e){}
        Filter();
    }

    private void FilterByMax(ChangeEventArgs eventArgs)
    {
        if (filterByNumbers == null)
            filterByNumbers = new float[2];
        try
        {
            filterByNumbers[1] = float.Parse(eventArgs.Value.ToString());
        }
        catch (Exception e){}
        Filter();
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IAdultService AdultService { get; set; }
    }
}
#pragma warning restore 1591
